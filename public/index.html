<!doctype html>
<html lang="ru" class="bg-gray-50 text-gray-900">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Cron Manager</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script
      src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"
      defer
    ></script>
    <style>
      [x-cloak] {
        display: none !important;
      }
      .tooltip {
        position: relative;
      }
      .tooltip-text {
        visibility: hidden;
        opacity: 0;
        width: max-content;
        max-width: 200px;
        background-color: #1f2937;
        color: #fff;
        text-align: center;
        border-radius: 6px;
        padding: 8px 12px;
        position: absolute;
        z-index: 1000;
        bottom: 125%;
        left: 50%;
        transform: translateX(-50%);
        font-size: 12px;
        transition: opacity 0.3s;
        white-space: normal;
      }
      .tooltip-text::after {
        content: '';
        position: absolute;
        top: 100%;
        left: 50%;
        margin-left: -5px;
        border-width: 5px;
        border-style: solid;
        border-color: #1f2937 transparent transparent transparent;
      }
      .tooltip:hover .tooltip-text,
      .tooltip.active .tooltip-text {
        visibility: visible;
        opacity: 1;
      }
    </style>
  </head>
  <body x-data="cronApp()" class="min-h-screen flex flex-col">
    <!-- Header -->
    <header
      class="bg-black text-white py-3 px-4 md:py-4 md:px-6 flex items-center justify-between flex-wrap gap-3"
    >
      <h1 class="text-lg md:text-xl font-semibold">Cron Manager</h1>
      <div class="flex items-center gap-2 md:gap-3">
        <template x-if="isAuthenticated">
          <div class="flex items-center gap-2 md:gap-3 flex-wrap">
            <span
              class="hidden sm:inline text-sm text-gray-300"
              x-text="'–ü—Ä–∏–≤–µ—Ç, ' + user.email"
            ></span>
            <button
              @click="openAddModal = true"
              class="bg-white text-black px-3 py-1.5 md:px-4 md:py-2 rounded-lg hover:bg-gray-200 transition text-sm md:text-base whitespace-nowrap"
            >
              + –ó–∞–¥–∞—á–∞
            </button>
            <button
              @click="logout()"
              class="bg-gray-700 text-white px-3 py-1.5 md:px-4 md:py-2 rounded-lg hover:bg-gray-600 transition text-sm md:text-base"
            >
              –í—ã–π—Ç–∏
            </button>
          </div>
        </template>
        <template x-if="!isAuthenticated">
          <div class="flex gap-2">
            <button
              @click="openLoginModal = true"
              class="bg-white text-black px-3 py-1.5 md:px-4 md:py-2 rounded-lg hover:bg-gray-200 transition text-sm md:text-base"
            >
              –í–æ–π—Ç–∏
            </button>
            <button
              @click="openRegisterModal = true"
              class="bg-gray-700 text-white px-3 py-1.5 md:px-4 md:py-2 rounded-lg hover:bg-gray-600 transition text-sm md:text-base"
            >
              –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
            </button>
          </div>
        </template>
      </div>
    </header>

    <!-- Main -->
    <main class="flex-1 flex flex-col p-3 md:p-6">
      <!-- –ï—Å–ª–∏ –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω -->
      <div
        x-show="!isAuthenticated"
        x-cloak
        class="flex-1 flex items-center justify-center"
      >
        <div class="text-center px-4">
          <h2 class="text-xl md:text-2xl font-semibold text-gray-700 mb-2">
            –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!
          </h2>
          <p class="text-sm md:text-base text-gray-500">
            –í–æ–π–¥–∏—Ç–µ –∏–ª–∏ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å, —á—Ç–æ–±—ã —É–ø—Ä–∞–≤–ª—è—Ç—å –∑–∞–¥–∞—á–∞–º–∏
          </p>
        </div>
      </div>

      <!-- –ï—Å–ª–∏ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω -->
      <div x-show="isAuthenticated" x-cloak>
        <!-- Desktop Table -->
        <div class="hidden md:block bg-white shadow rounded-lg overflow-hidden">
          <table class="min-w-full divide-y divide-gray-200">
            <thead class="bg-gray-100 text-gray-700 text-sm">
              <tr>
                <th class="px-4 py-2 text-left">–ò–º—è –∑–∞–¥–∞—á–∏</th>
                <th class="px-4 py-2 text-left">URL</th>
                <th class="px-4 py-2 text-left">–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ</th>
                <th class="px-4 py-2 text-left">–°—Ç–∞—Ç—É—Å</th>
                <th class="px-4 py-2 text-right">–î–µ–π—Å—Ç–≤–∏—è</th>
              </tr>
            </thead>
            <tbody class="divide-y divide-gray-100 text-sm">
              <template x-for="job in jobs" :key="job.id">
                <tr class="hover:bg-gray-50">
                  <td class="px-4 py-2" x-text="job.name"></td>
                  <td class="px-4 py-2">
                    <a
                      :href="job.url"
                      class="text-blue-600 hover:underline"
                      x-text="job.url"
                    ></a>
                  </td>
                  <td class="px-4 py-2">
                    <div class="flex items-center gap-1">
                      <span x-text="job.schedule"></span>
                      <div class="tooltip inline-block">
                        <span
                          class="cursor-help text-gray-400 hover:text-gray-600"
                          >‚ÑπÔ∏è</span
                        >
                        <span
                          class="tooltip-text"
                          x-text="getCronDescription(job.schedule)"
                        ></span>
                      </div>
                    </div>
                  </td>
                  <td class="px-4 py-2">
                    <span
                      class="px-2 py-1 text-xs rounded-full"
                      :class="job.active ? 'bg-green-100 text-green-700' : 'bg-gray-200 text-gray-600'"
                      x-text="job.active ? '–ê–∫—Ç–∏–≤–Ω–∞' : '–í—ã–∫–ª—é—á–µ–Ω–∞'"
                    ></span>
                  </td>
                  <td class="px-4 py-2 text-right space-x-2">
                    <button
                      @click="viewLogs(job.id)"
                      class="text-blue-600 hover:text-blue-800"
                      title="–ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤"
                    >
                      üìã
                    </button>
                    <button
                      @click="editJob(job)"
                      class="text-gray-600 hover:text-black"
                      title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å"
                    >
                      ‚úèÔ∏è
                    </button>
                    <button
                      @click="confirmDelete(job.id)"
                      class="text-red-500 hover:text-red-700"
                      title="–£–¥–∞–ª–∏—Ç—å"
                    >
                      üóë
                    </button>
                  </td>
                </tr>
              </template>
            </tbody>
          </table>
          <div
            x-show="jobs.length === 0"
            class="text-center py-6 text-gray-500"
          >
            –ù–µ—Ç –∑–∞–¥–∞—á. –î–æ–±–∞–≤—å –ø–µ—Ä–≤—É—é!
          </div>
        </div>

        <!-- Mobile Cards -->
        <div class="md:hidden space-y-3">
          <template x-for="job in jobs" :key="job.id">
            <div class="bg-white shadow rounded-lg p-4">
              <div class="flex justify-between items-start mb-2">
                <h3 class="font-semibold text-gray-900" x-text="job.name"></h3>
                <span
                  class="px-2 py-1 text-xs rounded-full whitespace-nowrap"
                  :class="job.active ? 'bg-green-100 text-green-700' : 'bg-gray-200 text-gray-600'"
                  x-text="job.active ? '–ê–∫—Ç–∏–≤–Ω–∞' : '–í—ã–∫–ª—é—á–µ–Ω–∞'"
                ></span>
              </div>

              <div class="text-sm text-gray-600 space-y-1 mb-3">
                <div class="flex items-start gap-2">
                  <span class="text-gray-400">üîó</span>
                  <a
                    :href="job.url"
                    class="text-blue-600 hover:underline break-all flex-1"
                    x-text="job.url"
                  ></a>
                </div>
                <div class="flex items-center gap-2">
                  <span class="text-gray-400">‚è±Ô∏è</span>
                  <span x-text="job.schedule"></span>
                  <div
                    class="tooltip inline-block"
                    @click="$event.currentTarget.classList.toggle('active')"
                  >
                    <span class="cursor-pointer text-gray-400">‚ÑπÔ∏è</span>
                    <span
                      class="tooltip-text"
                      x-text="getCronDescription(job.schedule)"
                    ></span>
                  </div>
                </div>
              </div>

              <div class="flex gap-2 pt-2 border-t border-gray-100">
                <button
                  @click="viewLogs(job.id)"
                  class="flex-1 bg-blue-50 text-blue-700 px-3 py-2 rounded hover:bg-blue-100 text-sm font-medium"
                >
                  üìã –õ–æ–≥–∏
                </button>
                <button
                  @click="editJob(job)"
                  class="flex-1 bg-gray-100 text-gray-700 px-3 py-2 rounded hover:bg-gray-200 text-sm font-medium"
                >
                  ‚úèÔ∏è –ò–∑–º–µ–Ω–∏—Ç—å
                </button>
                <button
                  @click="confirmDelete(job.id)"
                  class="flex-1 bg-red-50 text-red-700 px-3 py-2 rounded hover:bg-red-100 text-sm font-medium"
                >
                  üóë –£–¥–∞–ª–∏—Ç—å
                </button>
              </div>
            </div>
          </template>

          <div
            x-show="jobs.length === 0"
            class="text-center py-12 text-gray-500 bg-white rounded-lg"
          >
            –ù–µ—Ç –∑–∞–¥–∞—á. –î–æ–±–∞–≤—å –ø–µ—Ä–≤—É—é!
          </div>
        </div>
      </div>
      <!-- End of authenticated section -->

      <!-- Add/Edit Modal -->
      <div
        x-show="openAddModal"
        x-cloak
        x-transition
        class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4"
      >
        <div
          class="bg-white w-full max-w-md rounded-lg shadow-lg p-4 md:p-6 relative max-h-[90vh] overflow-y-auto"
          @click.outside="closeAddModal()"
        >
          <h2
            class="text-base md:text-lg font-semibold mb-4"
            x-text="editMode ? '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∑–∞–¥–∞—á—É' : '–ù–æ–≤–∞—è –∑–∞–¥–∞—á–∞'"
          ></h2>

          <form @submit.prevent="saveJob()">
            <label class="block text-sm mb-2">–ò–º—è</label>
            <input
              type="text"
              placeholder="Typicode JSON"
              x-model="form.name"
              class="w-full border rounded px-3 py-2 mb-3 text-base"
              required
            />

            <label class="block text-sm mb-2">URL</label>
            <input
              type="url"
              placeholder="https://jsonplaceholder.typicode.com/posts"
              x-model="form.url"
              class="w-full border rounded px-3 py-2 mb-3 text-base"
              required
            />

            <label class="block text-sm mb-2">HTTP –ú–µ—Ç–æ–¥</label>
            <select
              x-model="form.method"
              class="w-full border rounded px-3 py-2 mb-3 text-base"
            >
              <option value="GET">GET</option>
              <option value="POST">POST</option>
              <option value="PUT">PUT</option>
              <option value="PATCH">PATCH</option>
              <option value="DELETE">DELETE</option>
            </select>

            <template x-if="form.method !== 'GET'">
              <div>
                <label class="block text-sm mb-2">Headers (JSON)</label>
                <textarea
                  x-model="form.headers"
                  class="w-full border rounded px-3 py-2 mb-3 text-base font-mono text-sm"
                  rows="3"
                  placeholder='{"Content-Type": "application/json", "Authorization": "Bearer token"}'
                ></textarea>

                <label class="block text-sm mb-2">Body</label>
                <textarea
                  x-model="form.body"
                  class="w-full border rounded px-3 py-2 mb-3 text-base font-mono text-sm"
                  rows="4"
                  placeholder='{"key": "value"}'
                ></textarea>
              </div>
            </template>

            <label class="block text-sm mb-2">–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ</label>
            <select
              x-model="cronPreset"
              @change="if (cronPreset !== 'custom') { form.schedule = cronPreset }"
              class="w-full border rounded px-3 py-2 mb-3 text-base"
            >
              <template x-for="preset in cronPresets" :key="preset.value">
                <option :value="preset.value" x-text="preset.label"></option>
              </template>
            </select>

            <template x-if="cronPreset === 'custom'">
              <div>
                <label class="block text-sm mb-2">Cron –≤—ã—Ä–∞–∂–µ–Ω–∏–µ</label>
                <input
                  type="text"
                  x-model="form.schedule"
                  class="w-full border rounded px-3 py-2 mb-3 text-base font-mono"
                  placeholder="*/5 * * * *"
                  required
                />
              </div>
            </template>

            <label class="inline-flex items-center mb-3">
              <input
                type="checkbox"
                x-model="form.active"
                class="mr-2 w-4 h-4"
              />
              –ê–∫—Ç–∏–≤–Ω–∞
            </label>

            <div
              class="flex flex-col-reverse sm:flex-row justify-end gap-2 sm:gap-2 mt-4"
            >
              <button
                type="button"
                @click="closeAddModal()"
                class="w-full sm:w-auto px-4 py-2 text-gray-600 hover:text-black border border-gray-300 rounded hover:bg-gray-50"
              >
                –û—Ç–º–µ–Ω–∞
              </button>
              <button
                type="submit"
                class="w-full sm:w-auto bg-black text-white px-4 py-2 rounded hover:bg-gray-800"
              >
                –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
              </button>
            </div>
          </form>
        </div>
      </div>

      <!-- Delete Confirm Modal -->
      <div
        x-show="openDeleteModal"
        x-cloak
        x-transition
        class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4"
      >
        <div
          class="bg-white w-full max-w-sm rounded-lg shadow-lg p-4 md:p-6 text-center"
          @click.outside="openDeleteModal = false"
        >
          <h2
            class="text-base md:text-lg font-semibold mb-3 md:mb-4 text-red-600"
          >
            –£–¥–∞–ª–∏—Ç—å –∑–∞–¥–∞—á—É?
          </h2>
          <p class="text-sm text-gray-600 mb-4 md:mb-6">
            –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.
          </p>
          <div
            class="flex flex-col-reverse sm:flex-row justify-center gap-2 sm:gap-3"
          >
            <button
              @click="openDeleteModal = false"
              class="w-full sm:w-auto px-4 py-2 bg-gray-200 rounded hover:bg-gray-300"
            >
              –û—Ç–º–µ–Ω–∞
            </button>
            <button
              @click="deleteJob()"
              class="w-full sm:w-auto px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700"
            >
              –£–¥–∞–ª–∏—Ç—å
            </button>
          </div>
        </div>
      </div>

      <!-- Logs Modal -->
      <div
        x-show="openLogsModal"
        x-cloak
        x-transition
        class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4"
      >
        <div
          class="bg-white w-full max-w-4xl rounded-lg shadow-lg p-4 md:p-6 max-h-[80vh] flex flex-col"
          @click.outside="openLogsModal = false"
        >
          <div class="flex justify-between items-center mb-4">
            <h2 class="text-lg md:text-xl font-semibold">–ò—Å—Ç–æ—Ä–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è</h2>
            <button
              @click="openLogsModal = false"
              class="text-gray-400 hover:text-gray-600 text-2xl leading-none"
            >
              √ó
            </button>
          </div>

          <div class="overflow-auto flex-1">
            <template x-if="jobLogs.length === 0">
              <div class="text-center py-8 text-gray-500">
                –ù–µ—Ç –ª–æ–≥–æ–≤ –¥–ª—è —ç—Ç–æ–π –∑–∞–¥–∞—á–∏
              </div>
            </template>

            <template x-if="jobLogs.length > 0">
              <div class="space-y-3">
                <template x-for="log in jobLogs" :key="log.id">
                  <div class="border rounded-lg p-4">
                    <div
                      class="flex flex-wrap items-center justify-between gap-2 mb-2"
                    >
                      <span
                        class="px-2 py-1 text-xs rounded-full font-medium"
                        :class="log.status === 'success' ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-700'"
                        x-text="log.status === 'success' ? '‚úì –£—Å–ø–µ—à–Ω–æ' : '‚úó –û—à–∏–±–∫–∞'"
                      ></span>
                      <span
                        class="text-sm text-gray-500"
                        x-text="formatDate(log.executedAt)"
                      ></span>
                    </div>

                    <div class="text-sm space-y-1">
                      <div
                        class="flex items-center gap-2"
                        x-show="log.statusCode"
                      >
                        <span class="font-medium text-gray-600">HTTP:</span>
                        <span
                          class="px-2 py-0.5 rounded text-xs font-mono"
                          :class="log.statusCode >= 200 && log.statusCode < 300 ? 'bg-green-50 text-green-700' : 'bg-red-50 text-red-700'"
                          x-text="log.statusCode"
                        ></span>
                      </div>

                      <div
                        class="flex items-center gap-2"
                        x-show="log.duration"
                      >
                        <span class="font-medium text-gray-600">–í—Ä–µ–º—è:</span>
                        <span
                          class="text-gray-900"
                          x-text="log.duration + ' –º—Å'"
                        ></span>
                      </div>

                      <div x-show="log.response">
                        <div class="flex items-center justify-between mb-1">
                          <div class="font-medium text-gray-600">–û—Ç–≤–µ—Ç:</div>
                          <button
                            @click="viewFullResponse(log)"
                            class="text-xs text-blue-600 hover:text-blue-800 hover:underline"
                          >
                            –ü–æ–∫–∞–∑–∞—Ç—å –ø–æ–ª–Ω–æ—Å—Ç—å—é
                          </button>
                        </div>
                        <div
                          class="bg-gray-50 p-2 rounded text-xs font-mono overflow-x-auto break-all"
                          x-text="truncateText(log.response, 500)"
                        ></div>
                      </div>
                    </div>
                  </div>
                </template>
              </div>
            </template>
          </div>

          <div class="mt-4 pt-4 border-t">
            <button
              @click="openLogsModal = false"
              class="w-full sm:w-auto px-4 py-2 bg-gray-200 rounded hover:bg-gray-300"
            >
              –ó–∞–∫—Ä—ã—Ç—å
            </button>
          </div>
        </div>
      </div>

      <!-- Full Response Modal -->
      <div
        x-show="openFullResponseModal"
        x-cloak
        x-transition
        class="fixed inset-0 bg-black/50 flex items-center justify-center z-[60] p-4"
      >
        <div
          class="bg-white w-full max-w-5xl rounded-lg shadow-lg p-4 md:p-6 max-h-[90vh] flex flex-col"
          @click.outside="openFullResponseModal = false"
        >
          <div class="flex justify-between items-center mb-4">
            <div>
              <h2 class="text-lg md:text-xl font-semibold">–ü–æ–ª–Ω—ã–π –æ—Ç–≤–µ—Ç</h2>
              <div class="flex items-center gap-3 mt-2 text-sm">
                <span
                  class="px-2 py-1 text-xs rounded-full font-medium"
                  :class="selectedLog?.status === 'success' ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-700'"
                  x-text="selectedLog?.status === 'success' ? '‚úì –£—Å–ø–µ—à–Ω–æ' : '‚úó –û—à–∏–±–∫–∞'"
                ></span>
                <span
                  x-show="selectedLog?.statusCode"
                  class="px-2 py-0.5 rounded text-xs font-mono"
                  :class="selectedLog?.statusCode >= 200 && selectedLog?.statusCode < 300 ? 'bg-green-50 text-green-700' : 'bg-red-50 text-red-700'"
                  x-text="'HTTP ' + selectedLog?.statusCode"
                ></span>
                <span
                  x-show="selectedLog?.duration"
                  class="text-gray-600"
                  x-text="selectedLog?.duration + ' –º—Å'"
                ></span>
                <span
                  class="text-gray-500"
                  x-text="formatDate(selectedLog?.executedAt)"
                ></span>
              </div>
            </div>
            <button
              @click="openFullResponseModal = false"
              class="text-gray-400 hover:text-gray-600 text-2xl leading-none"
            >
              √ó
            </button>
          </div>

          <div class="overflow-auto flex-1 border rounded-lg">
            <pre
              class="p-4 text-xs font-mono whitespace-pre-wrap break-all bg-gray-50"
              x-text="selectedLog?.response || '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö'"
            ></pre>
          </div>

          <div class="mt-4 pt-4 border-t flex gap-2">
            <button
              @click="copyToClipboard(selectedLog?.response)"
              class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700"
            >
              üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å
            </button>
            <button
              @click="openFullResponseModal = false"
              class="px-4 py-2 bg-gray-200 rounded hover:bg-gray-300"
            >
              –ó–∞–∫—Ä—ã—Ç—å
            </button>
          </div>
        </div>
      </div>

      <!-- Login Modal -->
      <div
        x-show="openLoginModal"
        x-cloak
        x-transition
        class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4"
      >
        <div
          class="bg-white w-full max-w-md rounded-lg shadow-lg p-4 md:p-6 relative"
          @click.outside="openLoginModal = false"
        >
          <h2 class="text-base md:text-lg font-semibold mb-4">–í—Ö–æ–¥</h2>

          <form @submit.prevent="login()">
            <label class="block text-sm mb-2">Email</label>
            <input
              type="email"
              placeholder="email@example.com"
              x-model="loginForm.email"
              class="w-full border rounded px-3 py-2 mb-3 text-base"
              required
            />

            <label class="block text-sm mb-2">–ü–∞—Ä–æ–ª—å</label>
            <input
              type="password"
              placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å"
              x-model="loginForm.password"
              class="w-full border rounded px-3 py-2 mb-3 text-base"
              required
            />

            <div
              x-show="loginError"
              x-cloak
              class="text-red-600 text-sm mb-3"
              x-text="loginError"
            ></div>

            <div
              class="flex flex-col-reverse sm:flex-row justify-end gap-2 sm:gap-2 mt-4"
            >
              <button
                type="button"
                @click="openLoginModal = false"
                class="w-full sm:w-auto px-4 py-2 text-gray-600 hover:text-black border border-gray-300 rounded hover:bg-gray-50"
              >
                –û—Ç–º–µ–Ω–∞
              </button>
              <button
                type="submit"
                class="w-full sm:w-auto bg-black text-white px-4 py-2 rounded hover:bg-gray-800"
              >
                –í–æ–π—Ç–∏
              </button>
            </div>
          </form>
        </div>
      </div>

      <!-- Register Modal -->
      <div
        x-show="openRegisterModal"
        x-cloak
        x-transition
        class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4"
      >
        <div
          class="bg-white w-full max-w-md rounded-lg shadow-lg p-4 md:p-6 relative max-h-[90vh] overflow-y-auto"
          @click.outside="openRegisterModal = false"
        >
          <h2 class="text-base md:text-lg font-semibold mb-4">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h2>

          <form @submit.prevent="register()">
            <label class="block text-sm mb-2">Email</label>
            <input
              type="email"
              placeholder="email@example.com"
              x-model="registerForm.email"
              class="w-full border rounded px-3 py-2 mb-3 text-base"
              required
            />

            <label class="block text-sm mb-2">–ü–∞—Ä–æ–ª—å</label>
            <input
              type="password"
              placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å"
              x-model="registerForm.password"
              class="w-full border rounded px-3 py-2 mb-3 text-base"
              minlength="6"
              required
            />

            <label class="block text-sm mb-2">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å</label>
            <input
              type="password"
              placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å –µ—â–µ —Ä–∞–∑"
              x-model="registerForm.confirmPassword"
              class="w-full border rounded px-3 py-2 mb-3 text-base"
              minlength="6"
              required
            />

            <div
              x-show="registerError"
              x-cloak
              class="text-red-600 text-sm mb-3"
              x-text="registerError"
            ></div>

            <div
              class="flex flex-col-reverse sm:flex-row justify-end gap-2 sm:gap-2 mt-4"
            >
              <button
                type="button"
                @click="openRegisterModal = false"
                class="w-full sm:w-auto px-4 py-2 text-gray-600 hover:text-black border border-gray-300 rounded hover:bg-gray-50"
              >
                –û—Ç–º–µ–Ω–∞
              </button>
              <button
                type="submit"
                class="w-full sm:w-auto bg-black text-white px-4 py-2 rounded hover:bg-gray-800"
              >
                –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è
              </button>
            </div>
          </form>
        </div>
      </div>
    </main>

    <script>
      function cronApp() {
        return {
          jobs: [],
          openAddModal: false,
          openDeleteModal: false,
          openLoginModal: false,
          openRegisterModal: false,
          openLogsModal: false,
          openFullResponseModal: false,
          editMode: false,
          deleteId: null,
          selectedJobId: null,
          jobLogs: [],
          selectedLog: null,
          form: {
            id: null,
            name: '',
            url: '',
            method: 'GET',
            headers: '',
            body: '',
            schedule: '*/5 * * * *',
            active: true,
          },
          cronPreset: '*/5 * * * *',
          cronPresets: [
            { value: '* * * * *', label: '–ö–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É' },
            { value: '*/5 * * * *', label: '–ö–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç' },
            { value: '*/15 * * * *', label: '–ö–∞–∂–¥—ã–µ 15 –º–∏–Ω—É—Ç' },
            { value: '*/30 * * * *', label: '–ö–∞–∂–¥—ã–µ 30 –º–∏–Ω—É—Ç' },
            { value: '0 * * * *', label: '–ö–∞–∂–¥—ã–π —á–∞—Å' },
            { value: '0 */6 * * *', label: '–ö–∞–∂–¥—ã–µ 6 —á–∞—Å–æ–≤' },
            { value: '0 0 * * *', label: '–ö–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ –ø–æ–ª–Ω–æ—á—å' },
            { value: '0 12 * * *', label: '–ö–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 12:00' },
            { value: '0 0 * * 0', label: '–ö–∞–∂–¥–æ–µ –≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ –≤ –ø–æ–ª–Ω–æ—á—å' },
            { value: '0 0 1 * *', label: '–ü–µ—Ä–≤—ã–π –¥–µ–Ω—å –º–µ—Å—è—Ü–∞' },
            { value: 'custom', label: '–ö–∞—Å—Ç–æ–º–Ω—ã–π –∫—Ä–æ–Ω' },
          ],

          isAuthenticated: false,
          token: localStorage.getItem('jwt_token') || null,
          user: JSON.parse(localStorage.getItem('user') || '{}'),
          loginForm: { email: '', password: '' },
          registerForm: { email: '', password: '', confirmPassword: '' },
          loginError: '',
          registerError: '',

          async init() {
            if (this.token) {
              try {
                const meResponse = await fetch('/api/v1/auth/me', {
                  headers: {
                    Authorization: `Bearer ${this.token}`,
                  },
                });

                if (meResponse.ok) {
                  const userData = await meResponse.json();
                  this.user = userData;
                  this.isAuthenticated = true;
                  localStorage.setItem('user', JSON.stringify(userData));
                  await this.fetchJobs();
                } else {
                  this.logout();
                }
              } catch (error) {
                console.error('Failed to fetch user data:', error);
                this.logout();
              }
            }
          },

          async fetchJobs() {
            if (!this.token) return;

            try {
              const response = await fetch('/api/v1/jobs', {
                headers: {
                  Authorization: `Bearer ${this.token}`,
                },
              });

              if (response.ok) {
                const jobs = await response.json();
                this.jobs = jobs.map((job) => ({
                  ...job,
                  active: job.isActive,
                }));
              }
            } catch (error) {
              console.error('Failed to fetch jobs:', error);
            }
          },

          async login() {
            this.loginError = '';

            try {
              const response = await fetch('/api/v1/auth/login', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(this.loginForm),
              });

              if (!response.ok) {
                throw new Error('–ù–µ–≤–µ—Ä–Ω—ã–π email –∏–ª–∏ –ø–∞—Ä–æ–ª—å');
              }

              const data = await response.json();
              this.token = data.access_token;
              localStorage.setItem('jwt_token', data.access_token);

              const meResponse = await fetch('/api/v1/auth/me', {
                headers: {
                  Authorization: `Bearer ${data.access_token}`,
                },
              });

              if (!meResponse.ok) {
                throw new Error('–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è');
              }

              const userData = await meResponse.json();
              this.user = userData;
              this.isAuthenticated = true;

              localStorage.setItem('user', JSON.stringify(userData));

              this.openLoginModal = false;
              this.loginForm = { email: '', password: '' };

              await this.fetchJobs();
            } catch (error) {
              this.loginError = error.message || '–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞';
            }
          },

          async register() {
            this.registerError = '';

            if (
              this.registerForm.password !== this.registerForm.confirmPassword
            ) {
              this.registerError = '–ü–∞—Ä–æ–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç';
              return;
            }

            if (this.registerForm.password.length < 6) {
              this.registerError = '–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –º–∏–Ω–∏–º—É–º 6 —Å–∏–º–≤–æ–ª–æ–≤';
              return;
            }

            try {
              const response = await fetch('/api/v1/auth/register', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                  email: this.registerForm.email,
                  password: this.registerForm.password,
                }),
              });

              if (!response.ok) {
                const error = await response.json();
                throw new Error(error.message || '–û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏');
              }

              const data = await response.json();
              this.token = data.access_token;
              localStorage.setItem('jwt_token', data.access_token);

              const meResponse = await fetch('/api/v1/auth/me', {
                headers: {
                  Authorization: `Bearer ${data.access_token}`,
                },
              });

              if (!meResponse.ok) {
                throw new Error('–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è');
              }

              const userData = await meResponse.json();
              this.user = userData;
              this.isAuthenticated = true;

              localStorage.setItem('user', JSON.stringify(userData));

              this.openRegisterModal = false;
              this.registerForm = {
                email: '',
                password: '',
                confirmPassword: '',
              };
            } catch (error) {
              this.registerError = error.message || '–û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏';
            }
          },

          logout() {
            this.isAuthenticated = false;
            this.token = null;
            this.user = {};
            localStorage.removeItem('jwt_token');
            localStorage.removeItem('user');
            this.jobs = [];
          },

          resetForm() {
            this.form = {
              id: null,
              name: '',
              url: '',
              method: 'GET',
              headers: '',
              body: '',
              schedule: '*/5 * * * *',
              active: true,
            };
            this.cronPreset = '*/5 * * * *';
            this.editMode = false;
          },

          closeAddModal() {
            this.openAddModal = false;
            this.resetForm();
          },

          editJob(job) {
            this.form = JSON.parse(JSON.stringify(job));
            this.editMode = true;

            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –ª–∏ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –æ–¥–Ω–æ–º—É –∏–∑ –ø—Ä–µ—Å–µ—Ç–æ–≤
            const matchingPreset = this.cronPresets.find(
              (preset) =>
                preset.value === job.schedule && preset.value !== 'custom',
            );

            if (matchingPreset) {
              this.cronPreset = matchingPreset.value;
            } else {
              this.cronPreset = 'custom';
            }

            this.openAddModal = true;
          },
          async saveJob() {
            try {
              const jobData = {
                name: this.form.name,
                url: this.form.url,
                method: this.form.method || 'GET',
                headers: this.form.headers || null,
                body: this.form.body || null,
                schedule: this.form.schedule,
                isActive:
                  this.form.active !== undefined
                    ? this.form.active
                    : this.form.isActive,
              };

              if (this.editMode) {
                const response = await fetch(`/api/v1/jobs/${this.form.id}`, {
                  method: 'PATCH',
                  headers: {
                    'Content-Type': 'application/json',
                    Authorization: `Bearer ${this.token}`,
                  },
                  body: JSON.stringify(jobData),
                });

                if (!response.ok) {
                  throw new Error('–ù–µ —É–¥–∞–ª–æ—Å—å –æ–±–Ω–æ–≤–∏—Ç—å –∑–∞–¥–∞—á—É');
                }
              } else {
                const response = await fetch('/api/v1/jobs', {
                  method: 'POST',
                  headers: {
                    'Content-Type': 'application/json',
                    Authorization: `Bearer ${this.token}`,
                  },
                  body: JSON.stringify(jobData),
                });

                if (!response.ok) {
                  throw new Error('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ–∑–¥–∞—Ç—å –∑–∞–¥–∞—á—É');
                }
              }

              // Refresh jobs list
              await this.fetchJobs();

              this.openAddModal = false;
              this.resetForm();
            } catch (error) {
              console.error('Failed to save job:', error);
              alert(error.message || '–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –∑–∞–¥–∞—á–∏');
            }
          },
          confirmDelete(id) {
            this.deleteId = id;
            this.openDeleteModal = true;
          },
          async deleteJob() {
            try {
              const response = await fetch(`/api/v1/jobs/${this.deleteId}`, {
                method: 'DELETE',
                headers: {
                  Authorization: `Bearer ${this.token}`,
                },
              });

              if (!response.ok) {
                throw new Error('–ù–µ —É–¥–∞–ª–æ—Å—å —É–¥–∞–ª–∏—Ç—å –∑–∞–¥–∞—á—É');
              }

              // Refresh jobs list
              await this.fetchJobs();

              this.openDeleteModal = false;
            } catch (error) {
              console.error('Failed to delete job:', error);
              alert(error.message || '–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –∑–∞–¥–∞—á–∏');
            }
          },

          async viewLogs(jobId) {
            this.selectedJobId = jobId;
            this.openLogsModal = true;
            this.jobLogs = [];

            if (!this.token) return;

            try {
              const response = await fetch(
                `/api/v1/job-logs/job/${jobId}?limit=50`,
                {
                  headers: {
                    Authorization: `Bearer ${this.token}`,
                  },
                },
              );

              if (response.ok) {
                this.jobLogs = await response.json();
              }
            } catch (error) {
              console.error('Failed to fetch logs:', error);
            }
          },

          viewFullResponse(log) {
            this.selectedLog = log;
            this.openFullResponseModal = true;
          },

          async copyToClipboard(text) {
            if (!text) return;

            try {
              await navigator.clipboard.writeText(text);
              alert('–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞!');
            } catch (error) {
              console.error('Failed to copy:', error);
              alert('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å');
            }
          },

          formatDate(dateString) {
            if (!dateString) return '';
            const date = new Date(dateString);
            return date.toLocaleString('ru-RU', {
              year: 'numeric',
              month: '2-digit',
              day: '2-digit',
              hour: '2-digit',
              minute: '2-digit',
              second: '2-digit',
            });
          },

          truncateText(text, maxLength = 100) {
            if (!text) return '';
            if (text.length <= maxLength) return text;
            return text.substring(0, maxLength) + '...';
          },

          getCronDescription(cron) {
            if (!cron) return '–ù–µ —É–∫–∞–∑–∞–Ω–æ';

            const parts = cron.trim().split(/\s+/);
            if (parts.length !== 5) return '–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç';

            const [minute, hour, dayOfMonth, month, dayOfWeek] = parts;

            // –ö–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É
            if (cron === '* * * * *') return '–ö–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É';

            // –ö–∞–∂–¥—ã–µ N –º–∏–Ω—É—Ç
            if (
              minute.startsWith('*/') &&
              hour === '*' &&
              dayOfMonth === '*' &&
              month === '*' &&
              dayOfWeek === '*'
            ) {
              const mins = minute.split('/')[1];
              return `–ö–∞–∂–¥—ã–µ ${mins} ${this.pluralize(mins, '–º–∏–Ω—É—Ç—É', '–º–∏–Ω—É—Ç—ã', '–º–∏–Ω—É—Ç')}`;
            }

            // –ö–∞–∂–¥—ã–π —á–∞—Å
            if (
              minute === '0' &&
              hour === '*' &&
              dayOfMonth === '*' &&
              month === '*' &&
              dayOfWeek === '*'
            ) {
              return '–ö–∞–∂–¥—ã–π —á–∞—Å';
            }

            // –ö–∞–∂–¥—ã–µ N —á–∞—Å–æ–≤
            if (
              hour.startsWith('*/') &&
              dayOfMonth === '*' &&
              month === '*' &&
              dayOfWeek === '*'
            ) {
              const hrs = hour.split('/')[1];
              return `–ö–∞–∂–¥—ã–µ ${hrs} ${this.pluralize(hrs, '—á–∞—Å', '—á–∞—Å–∞', '—á–∞—Å–æ–≤')}`;
            }

            // –ï–∂–µ–¥–Ω–µ–≤–Ω–æ –≤ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–µ –≤—Ä–µ–º—è
            if (
              !minute.includes('*') &&
              !hour.includes('*') &&
              dayOfMonth === '*' &&
              month === '*' &&
              dayOfWeek === '*'
            ) {
              return `–ï–∂–µ–¥–Ω–µ–≤–Ω–æ –≤ ${hour.padStart(2, '0')}:${minute.padStart(2, '0')}`;
            }

            // –ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω–æ
            if (
              !minute.includes('*') &&
              !hour.includes('*') &&
              dayOfMonth === '*' &&
              month === '*' &&
              !dayOfWeek.includes('*')
            ) {
              const days = [
                '–≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ',
                '–ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫',
                '–≤—Ç–æ—Ä–Ω–∏–∫',
                '—Å—Ä–µ–¥—É',
                '—á–µ—Ç–≤–µ—Ä–≥',
                '–ø—è—Ç–Ω–∏—Ü—É',
                '—Å—É–±–±–æ—Ç—É',
              ];
              return `–ö–∞–∂–¥—ã–π ${days[parseInt(dayOfWeek)] || '–¥–µ–Ω—å'} –≤ ${hour.padStart(2, '0')}:${minute.padStart(2, '0')}`;
            }

            // –ï–∂–µ–º–µ—Å—è—á–Ω–æ
            if (
              !minute.includes('*') &&
              !hour.includes('*') &&
              !dayOfMonth.includes('*') &&
              month === '*' &&
              dayOfWeek === '*'
            ) {
              return `–ö–∞–∂–¥—ã–π –º–µ—Å—è—Ü ${dayOfMonth}-–≥–æ —á–∏—Å–ª–∞ –≤ ${hour.padStart(2, '0')}:${minute.padStart(2, '0')}`;
            }

            return '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ';
          },

          pluralize(number, one, two, five) {
            let n = Math.abs(number);
            n %= 100;
            if (n >= 5 && n <= 20) return five;
            n %= 10;
            if (n === 1) return one;
            if (n >= 2 && n <= 4) return two;
            return five;
          },
        };
      }
    </script>
  </body>
</html>
